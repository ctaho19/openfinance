import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.Cd_vQiNd.js";import{C as z,a as J,b as K,c as Q}from"./card.qLBZpUmG.js";import{Button as C}from"./button.BMzpYdhZ.js";import{A as V,B as W}from"./bank-badge.dC5kaTwp.js";import"./createLucideIcon.DV6VgPWa.js";function X(x,m,u){const d=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"});return`${x} payments of $${m.toFixed(2)} starting ${d.format(u)}`}function Z(x){const{principal:m,totalRepayable:u,numberOfPayments:d,frequency:b}=x;if(m<=0||u<=0||d<=0||Math.abs(u-m)<.01)return 0;const N=u-m;let r;switch(b){case"weekly":r=d*7/30.44;break;case"biweekly":r=d*14/30.44;break;case"monthly":r=d;break}const v=r/12,f=N/m/v*100;return Math.round(f*100)/100}const ee=[{value:"CREDIT_CARD",label:"Credit Card"},{value:"AUTO_LOAN",label:"Auto Loan"},{value:"STUDENT_LOAN",label:"Student Loan"},{value:"PERSONAL_LOAN",label:"Personal Loan"},{value:"BNPL",label:"Buy Now Pay Later"},{value:"MORTGAGE",label:"Mortgage"},{value:"OTHER",label:"Other"}],ae=[2,3,4,5,6,8,10,12,18,24,36,48,60],te=[{value:"weekly",label:"Weekly"},{value:"biweekly",label:"Bi-weekly"},{value:"monthly",label:"Monthly"}];function oe(){const[x,m]=s.useState(!1),[u,d]=s.useState(""),[b,N]=s.useState(""),[r,v]=s.useState(""),[f,T]=s.useState("4"),[P,k]=s.useState(""),[h,I]=s.useState(""),[g,O]=s.useState("monthly"),[B,E]=s.useState([]),[F,D]=s.useState(""),[i,M]=s.useState(""),[A,L]=s.useState(""),[j,q]=s.useState(!1),n=b==="BNPL";s.useEffect(()=>{fetch("/api/bank-accounts").then(a=>a.json()).then(a=>{if(Array.isArray(a)){E(a);const t=a.find(p=>p.isDefault);t&&D(t.id)}}).catch(()=>{})},[]);const o=parseInt(P||f,10),R=s.useMemo(()=>{if(!n||!r||!o||!h)return null;const a=parseFloat(r);if(isNaN(a)||isNaN(o)||a<=0||o<=0)return null;const t=i?parseFloat(i):a,p=Math.round(t/o*100)/100;return X(o,p,new Date(h+"T00:00:00"))},[n,r,i,o,h]),w=s.useMemo(()=>{if(!n||!r||!o)return null;const a=parseFloat(r),t=i?parseFloat(i):a;return isNaN(a)||isNaN(t)||a<=0||t<=0||Math.abs(t-a)<.01?null:Z({principal:a,totalRepayable:t,numberOfPayments:o,frequency:g})},[n,r,i,o,g]);async function $(a){a.preventDefault(),m(!0),d("");const t=new FormData(a.currentTarget),p=parseFloat(t.get("currentBalance")),_=n&&i?parseFloat(i):p,H=n&&o>0?Math.round(_/o*100)/100:parseFloat(t.get("minimumPayment")),U=n?j&&A?parseFloat(A):0:parseFloat(t.get("interestRate")),Y=n&&h?new Date(h+"T00:00:00").getDate():parseInt(t.get("dueDay"),10),y={name:t.get("name"),type:t.get("type"),currentBalance:p,originalBalance:parseFloat(t.get("originalBalance")),interestRate:U,minimumPayment:H,dueDay:Y,notes:t.get("notes")||null};n&&(y.numberOfPayments=o,y.firstPaymentDate=h,y.paymentFrequency=g,i&&parseFloat(i)!==p&&(y.totalRepayable=parseFloat(i))),F&&(y.bankAccountId=F);const S=await fetch("/api/debts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(S.ok)window.location.href="/dashboard/debts";else{const G=await S.json();d(G.error||"Failed to create debt"),m(!1)}}const l="w-full px-4 py-2 bg-theme-secondary border border-theme rounded-xl text-theme-primary placeholder-theme-muted focus:outline-none focus:ring-2 focus:ring-accent-500/20 focus:border-accent-500",c="block text-sm font-medium text-theme-secondary mb-2";return e.jsxs("div",{className:"animate-fade-in max-w-2xl mx-auto space-y-6 lg:space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:"/dashboard/debts",children:e.jsx(C,{variant:"ghost",size:"sm",leftIcon:e.jsx(V,{className:"h-4 w-4"}),children:"Back"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-theme-primary",children:"Add New Debt"}),e.jsx("p",{className:"text-theme-secondary mt-1",children:"Track a new debt account"})]})]}),e.jsxs(z,{children:[e.jsx(J,{children:e.jsx(K,{children:"Debt Details"})}),e.jsx(Q,{children:e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[u&&e.jsx("div",{className:"p-3 rounded-xl bg-danger-50 dark:bg-danger-600/10 border border-danger-200 dark:border-danger-600/30 text-danger-700 dark:text-danger-400 text-sm",children:u}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:c,children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",required:!0,autoFocus:!0,placeholder:"e.g., Chase Sapphire or Affirm - Laptop",className:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:c,children:"Type"}),e.jsxs("select",{id:"type",name:"type",required:!0,className:l,value:b,onChange:a=>N(a.target.value),children:[e.jsx("option",{value:"",children:"Select type..."}),ee.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentBalance",className:c,children:n?"Total Amount ($)":"Current Balance ($)"}),e.jsx("input",{type:"number",id:"currentBalance",name:"currentBalance",required:!0,min:"0",step:"0.01",inputMode:"decimal",placeholder:n?"1200.00":"5000.00",className:l,value:r,onChange:a=>v(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"originalBalance",className:c,children:"Original Balance ($)"}),e.jsx("input",{type:"number",id:"originalBalance",name:"originalBalance",required:!0,min:"0",step:"0.01",inputMode:"decimal",placeholder:n?r||"1200.00":"10000.00",defaultValue:n?r:"",className:l})]})]}),n&&e.jsxs("div",{className:"p-4 bg-theme-tertiary border border-theme rounded-xl space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-accent",children:"BNPL Payment Schedule"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"numberOfPayments",className:c,children:"Number of Payments"}),e.jsx("select",{id:"numberOfPayments",name:"numberOfPayments",className:l,value:f,onChange:a=>{T(a.target.value),k("")},children:ae.map(a=>e.jsxs("option",{value:a,children:[a," payments"]},a))}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"number",placeholder:"Or enter custom...",min:"1",max:"360",className:`${l} text-sm`,value:P,onChange:a=>k(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"firstPaymentDate",className:c,children:"First Payment Date"}),e.jsx("input",{type:"date",id:"firstPaymentDate",name:"firstPaymentDate",required:!0,className:l,value:h,onChange:a=>I(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"paymentFrequency",className:c,children:"Payment Frequency"}),e.jsx("select",{id:"paymentFrequency",name:"paymentFrequency",required:!0,className:l,value:g,onChange:a=>O(a.target.value),children:te.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),R&&e.jsxs("div",{className:"p-3 bg-accent/10 border border-accent/30 rounded-xl text-theme-primary text-sm",children:[e.jsx("span",{className:"font-medium text-accent",children:"Preview:"})," ",R]}),e.jsxs("div",{className:"border-t border-theme pt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"bnplHasInterest",checked:j,onChange:a=>q(a.target.checked),className:"h-4 w-4 rounded border-theme bg-theme-secondary text-accent-600 focus:ring-accent-500"}),e.jsx("label",{htmlFor:"bnplHasInterest",className:"text-sm text-theme-secondary",children:"This BNPL loan has interest or finance charges"})]}),j&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pl-7",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"bnplInterestRate",className:c,children:["Stated APR (%) ",e.jsx("span",{className:"text-theme-muted font-normal",children:"- if shown by provider"})]}),e.jsx("input",{type:"number",id:"bnplInterestRate",min:"0",max:"100",step:"0.01",placeholder:"0.00",className:l,value:A,onChange:a=>L(a.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"totalRepayable",className:c,children:["Total to Repay ($) ",e.jsx("span",{className:"text-theme-muted font-normal",children:"- if different from principal"})]}),e.jsx("input",{type:"number",id:"totalRepayable",min:"0",step:"0.01",placeholder:r||"0.00",className:l,value:i,onChange:a=>M(a.target.value)}),e.jsx("p",{className:"text-xs text-theme-muted mt-1",children:"Enter the total amount you'll pay including any built-in interest"})]})]}),w!==null&&w>0&&e.jsxs("div",{className:"p-3 bg-warning-50 dark:bg-warning-600/10 border border-warning-200 dark:border-warning-600/30 rounded-xl text-sm",children:[e.jsx("span",{className:"font-medium text-warning-700 dark:text-warning-400",children:"Effective APR:"})," ",e.jsxs("span",{className:"text-theme-primary",children:[w.toFixed(2),"%"]}),e.jsx("span",{className:"text-theme-muted ml-2",children:"(computed from total repayable vs principal)"})]}),!j&&e.jsx("p",{className:"text-xs text-theme-muted pl-7",children:"Leave unchecked for 0% promo BNPL (Afterpay, Klarna Pay in 4, etc.)"})]})]}),!n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"interestRate",className:c,children:"Interest Rate (% APR)"}),e.jsx("input",{type:"number",id:"interestRate",name:"interestRate",required:!0,min:"0",max:"100",step:"0.01",inputMode:"decimal",placeholder:"19.99",className:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"minimumPayment",className:c,children:"Minimum Payment ($)"}),e.jsx("input",{type:"number",id:"minimumPayment",name:"minimumPayment",required:!0,min:"0",step:"0.01",inputMode:"decimal",placeholder:"150.00",className:l})]})]}),!n&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dueDay",className:c,children:"Due Day of Month (1-31)"}),e.jsx("input",{type:"number",id:"dueDay",name:"dueDay",required:!0,min:"1",max:"31",placeholder:"15",className:l})]}),B.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:c,children:"Payment Bank Account"}),e.jsx(W,{value:F,onChange:D,banks:B})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:c,children:"Notes (optional)"}),e.jsx("textarea",{id:"notes",name:"notes",rows:3,placeholder:"Any additional notes about this debt...",className:l})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(C,{type:"submit",disabled:x,children:x?"Creating...":"Add Debt"}),e.jsx("a",{href:"/dashboard/debts",children:e.jsx(C,{type:"button",variant:"secondary",children:"Cancel"})})]})]})})]})]})}export{oe as default};
//# sourceMappingURL=new-debt-form.pfAvZe7Y.js.map
