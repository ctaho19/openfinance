import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.Cd_vQiNd.js";import{C as N,c as v,a as B,b as w}from"./card.CxXQM9B9.js";import{B as d}from"./button.B0dCfUPv.js";import{B as O}from"./bank-badge.AOlTl-fr.js";import{A as C}from"./arrow-left.CGCSNnMn.js";import"./createLucideIcon.DV6VgPWa.js";import"./building-2.CScN-oDP.js";const L=[{value:"SUBSCRIPTION",label:"Subscription"},{value:"UTILITY",label:"Utility"},{value:"LOAN",label:"Loan"},{value:"BNPL",label:"Buy Now Pay Later"},{value:"INSURANCE",label:"Insurance"},{value:"CREDIT_CARD",label:"Credit Card"},{value:"OTHER",label:"Other"}],D=[{value:"ONCE",label:"One-time"},{value:"WEEKLY",label:"Weekly"},{value:"BIWEEKLY",label:"Bi-weekly"},{value:"MONTHLY",label:"Monthly"},{value:"YEARLY",label:"Yearly"}];function $({billId:o}){const[k,I]=l.useState(!0),[u,h]=l.useState(!1),[x,i]=l.useState(""),[y,S]=l.useState([]),[p,E]=l.useState([]),[b,g]=l.useState(""),[s,f]=l.useState({name:"",category:"OTHER",amount:"",dueDay:"",dueDate:"",isRecurring:!0,frequency:"MONTHLY",debtId:"",notes:""});l.useEffect(()=>{Promise.all([fetch(`/api/bills/${o}`).then(a=>a.json()),fetch("/api/debts").then(a=>a.json()),fetch("/api/bank-accounts").then(a=>a.json())]).then(([a,t,c])=>{a&&!a.error?(a.frequency==="ONCE"||a.isRecurring,f({name:a.name||"",category:a.category||"OTHER",amount:a.amount?.toString()||"",dueDay:a.dueDay?.toString()||"",dueDate:"",isRecurring:a.isRecurring??!0,frequency:a.frequency||"MONTHLY",debtId:a.debtId||"",notes:a.notes||""}),g(a.bankAccountId||"")):i("Failed to load bill"),Array.isArray(t)&&S(t),Array.isArray(c)&&E(c)}).catch(()=>{i("Failed to load bill data")}).finally(()=>{I(!1)})},[o]);const j=s.frequency==="ONCE"||!s.isRecurring,R=async a=>{a.preventDefault(),i(""),h(!0);try{const t={name:s.name,category:s.category,amount:parseFloat(s.amount),isRecurring:s.isRecurring,frequency:s.isRecurring?s.frequency:"ONCE",debtId:s.debtId||null,bankAccountId:b||null,notes:s.notes||null};j&&s.dueDate?t.dueDate=new Date(s.dueDate).toISOString():t.dueDay=parseInt(s.dueDay,10);const c=await fetch(`/api/bills/${o}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!c.ok){const m=await c.json();throw new Error(m.error||"Failed to update bill")}window.location.href="/dashboard/bills"}catch(t){i(t instanceof Error?t.message:"Something went wrong")}finally{h(!1)}},n=a=>{const{name:t,value:c,type:m}=a.target;f(A=>({...A,[t]:m==="checkbox"?a.target.checked:c}))},r="w-full px-4 py-2 bg-theme-secondary border border-theme rounded-xl text-theme-primary placeholder-theme-muted focus:outline-none focus:ring-2 focus:ring-accent-500/20 focus:border-accent-500";return k?e.jsxs("div",{className:"animate-fade-in space-y-6 lg:space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:"/dashboard/bills",children:e.jsx(d,{variant:"ghost",size:"sm",leftIcon:e.jsx(C,{className:"h-4 w-4"}),children:"Back"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-theme-primary",children:"Edit Bill"}),e.jsx("p",{className:"text-theme-secondary mt-1",children:"Loading bill details..."})]})]}),e.jsx(N,{children:e.jsx(v,{className:"py-12",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-500"})})})})]}):e.jsxs("div",{className:"animate-fade-in space-y-6 lg:space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:"/dashboard/bills",children:e.jsx(d,{variant:"ghost",size:"sm",leftIcon:e.jsx(C,{className:"h-4 w-4"}),children:"Back"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-theme-primary",children:"Edit Bill"}),e.jsx("p",{className:"text-theme-secondary mt-1",children:"Update bill details"})]})]}),e.jsxs(N,{children:[e.jsx(B,{children:e.jsx(w,{children:"Bill Details"})}),e.jsx(v,{children:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[x&&e.jsx("div",{className:"p-3 rounded-xl bg-danger-50 dark:bg-danger-600/10 border border-danger-200 dark:border-danger-600/30 text-danger-700 dark:text-danger-400 text-sm",children:x}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-theme-secondary",children:"Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",required:!0,autoFocus:!0,value:s.name,onChange:n,placeholder:"e.g., Netflix, Electric Bill",className:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-theme-secondary",children:"Category"}),e.jsx("select",{id:"category",name:"category",value:s.category,onChange:n,className:r,children:L.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-theme-secondary",children:"Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-theme-muted",children:"$"}),e.jsx("input",{type:"number",id:"amount",name:"amount",required:!0,min:"0",step:"0.01",inputMode:"decimal",value:s.amount,onChange:n,placeholder:"0.00",className:`${r} pl-8`})]})]}),j?e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-theme-secondary",children:"Due Date"}),e.jsx("input",{type:"date",id:"dueDate",name:"dueDate",value:s.dueDate,onChange:n,className:r}),e.jsx("p",{className:"text-xs text-theme-muted",children:"Leave empty to keep current due date"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"dueDay",className:"block text-sm font-medium text-theme-secondary",children:"Due Day (1-31) *"}),e.jsx("input",{type:"number",id:"dueDay",name:"dueDay",required:!0,min:"1",max:"31",value:s.dueDay,onChange:n,placeholder:"15",className:r})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"isRecurring",name:"isRecurring",checked:s.isRecurring,onChange:n,className:"h-4 w-4 rounded border-theme bg-theme-secondary text-accent-600 focus:ring-accent-500 focus:ring-offset-theme-primary"}),e.jsx("label",{htmlFor:"isRecurring",className:"text-sm font-medium text-theme-secondary",children:"This is a recurring bill"})]}),s.isRecurring&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"frequency",className:"block text-sm font-medium text-theme-secondary",children:"Frequency"}),e.jsx("select",{id:"frequency",name:"frequency",value:s.frequency,onChange:n,className:r,children:D.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),y.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"debtId",className:"block text-sm font-medium text-theme-secondary",children:"Link to Debt Account (Optional)"}),e.jsxs("select",{id:"debtId",name:"debtId",value:s.debtId,onChange:n,className:r,children:[e.jsx("option",{value:"",children:"None"}),y.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.type.toLowerCase().replace("_"," "),")"]},a.id))]})]}),p.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary",children:"Payment Bank Account"}),e.jsx(O,{value:b,onChange:g,banks:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-theme-secondary",children:"Notes (Optional)"}),e.jsx("textarea",{id:"notes",name:"notes",rows:3,value:s.notes,onChange:n,placeholder:"Any additional notes about this bill...",className:`${r} resize-none`})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(d,{type:"submit",disabled:u,children:u?"Saving...":"Save Changes"}),e.jsx("a",{href:"/dashboard/bills",children:e.jsx(d,{type:"button",variant:"secondary",children:"Cancel"})})]})]})})]})]})}export{$ as default};
//# sourceMappingURL=edit-bill-form.kMctVXlY.js.map
