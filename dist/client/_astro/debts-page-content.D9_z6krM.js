import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as b}from"./index.Cd_vQiNd.js";import{C as B,a as K,b as Z,c as A,S as _}from"./card.CxXQM9B9.js";import{B as k}from"./button.CwHoT6VS.js";import{X as ee}from"./x.DGcJ3xm4.js";import{T as te}from"./target.BCJb0dyN.js";import{T as ae}from"./trending-up.-SPj7Q4X.js";import{C as se}from"./circle-check.DAlLMW5e.js";import{S as ne}from"./search-input.BPHSkXTY.js";import{P as z}from"./plus.t7qQNRkr.js";import{C as U}from"./credit-card.BTOJU1Ei.js";import{W as re}from"./wallet.-jnlrgP3.js";import{T as ie}from"./trending-down.Cc3M3PIz.js";import{F as G}from"./file-text.C5K_yrNJ.js";import{H as le,B as ce,G as oe,C as me}from"./house.X1AQl01F.js";import{C as de}from"./calendar.5JjKPgNr.js";import{D as he}from"./dollar-sign.CHVyf0eC.js";import{P as ue,T as xe}from"./trash-2.B9ETjWXL.js";import{C as fe}from"./circle-alert.BeHv8yt-.js";import{c as pe}from"./createLucideIcon.DV6VgPWa.js";import"./loader-circle.k_JR3RqT.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Ne=pe("arrow-up-down",ye);function ge({debtId:s,debtName:u,currentBalance:x,minimumPayment:j,onClose:m}){const[N,o]=b.useState(j.toString()),[h,f]=b.useState(new Date().toISOString().split("T")[0]),[p,g]=b.useState(""),[D,y]=b.useState(!1),[l,c]=b.useState("");async function v(a){a.preventDefault(),y(!0),c("");const r=await fetch(`/api/debts/${s}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:Number(N),date:h,notes:p})});if(r.ok)window.location.reload(),m();else{const S=await r.json();c(S.error||"Failed to log payment")}y(!1)}return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(B,{className:"w-full max-w-md",children:[e.jsx(K,{children:e.jsxs(Z,{children:["Log Payment - ",u]})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-theme-secondary mb-1",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",max:x,value:N,onChange:a=>o(a.target.value),className:"w-full px-3 py-2 bg-theme-secondary border border-theme rounded-lg text-theme-primary focus:outline-none focus:ring-2 focus:ring-accent-500",required:!0}),e.jsxs("p",{className:"text-xs text-theme-muted mt-1",children:["Current balance: $",x.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-theme-secondary mb-1",children:"Date"}),e.jsx("input",{type:"date",value:h,onChange:a=>f(a.target.value),className:"w-full px-3 py-2 bg-theme-secondary border border-theme rounded-lg text-theme-primary focus:outline-none focus:ring-2 focus:ring-accent-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-theme-secondary mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:p,onChange:a=>g(a.target.value),rows:2,className:"w-full px-3 py-2 bg-theme-secondary border border-theme rounded-lg text-theme-primary focus:outline-none focus:ring-2 focus:ring-accent-500 resize-none"})]}),l&&e.jsx("p",{className:"text-red-400 text-sm",children:l}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{type:"button",variant:"secondary",onClick:m,className:"flex-1",children:"Cancel"}),e.jsx(k,{type:"submit",disabled:D,className:"flex-1",children:D?"Saving...":"Log Payment"})]})]})})]})})}function be(s){const u=s.filter(a=>a.status!=="PAID_OFF"&&Number(a.currentBalance)>0);if(u.length===0)return null;const x=[...u].sort((a,r)=>Number(a.currentBalance)-Number(r.currentBalance));x.reduce((a,r)=>a+Number(r.minimumPayment),0);const j=x.reduce((a,r)=>a+Number(r.currentBalance),0),m=s.reduce((a,r)=>r.status==="PAID_OFF"?a:a+Number(r.currentBalance),0);let N=x.map(a=>({name:a.name,balance:Number(a.currentBalance),rate:Number(a.interestRate)/100/12,minPayment:Number(a.minimumPayment),isPaidOff:!1})),o=0,h=0,f=0,p=0,g=null;const D=360;for(;N.some(a=>!a.isPaidOff)&&o<D;){o++;let a=p;for(const r of N){if(r.isPaidOff)continue;const S=r.balance*r.rate;h+=S,r.balance+=S;let T=r.minPayment+a;a=0,T>=r.balance&&(T=r.balance,r.isPaidOff=!0,p+=r.minPayment,g||(g={name:r.name,monthsUntilPaid:o,interestSaved:0})),r.balance=Math.max(0,r.balance-T)}}for(const a of x){let r=Number(a.currentBalance);const S=Number(a.interestRate)/100/12,T=Number(a.minimumPayment);for(let M=0;M<D&&r>0;M++){const O=r*S;f+=O,r=Math.max(0,r+O-T)}}const y=Math.max(0,f-h);g&&(g.interestSaved=Math.round(y/u.length));const l=new Date;l.setMonth(l.getMonth()+o);const c=s.filter(a=>a.status==="PAID_OFF").length,v=m>0?(m-j)/m*100:0;return{debtFreeDate:l,totalInterestSaved:Math.round(y),nextDebtToPayOff:g,totalPaid:m-j,progressPercent:Math.max(0,Math.min(100,v)),debtsEliminated:c,totalDebts:s.length}}function je(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(s)}function we({debts:s}){const[u,x]=b.useState(!1),j=be(s);if(!j||u)return null;const{debtFreeDate:m,totalInterestSaved:N,nextDebtToPayOff:o,progressPercent:h}=j,f=m.toLocaleDateString("en-US",{month:"long",year:"numeric"});return e.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-accent-500 via-accent-600 to-accent-700 dark:from-accent-700 dark:via-accent-700 dark:to-accent-800 text-white shadow-lg",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/2"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2"}),e.jsx("button",{onClick:()=>x(!0),className:"absolute top-3 right-3 p-1 rounded-full hover:bg-white/20 transition-colors","aria-label":"Dismiss",children:e.jsx(ee,{className:"h-4 w-4 text-white/70"})}),e.jsxs("div",{className:"relative p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-white/20",children:e.jsx(te,{className:"h-4 w-4 text-white"})}),e.jsx("h3",{className:"font-semibold text-sm text-white",children:"Debt Freedom Plan"})]}),e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Stay consistent and be debt-free by"}),e.jsx("p",{className:"text-2xl font-bold tracking-tight mb-4",children:f}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/70 mb-1.5",children:[e.jsxs("span",{children:[h.toFixed(0),"% paid off"]}),N>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),"Save ",je(N)," in interest"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-white/20 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-white transition-all duration-500",style:{width:`${Math.max(h,2)}%`}})})]}),o&&e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-white/20",children:[e.jsx(se,{className:"h-4 w-4 text-white/80 shrink-0"}),e.jsxs("p",{className:"text-sm text-white/90",children:[e.jsx("span",{className:"font-medium",children:"Next milestone:"})," ",'Pay off "',o.name,'" in ',o.monthsUntilPaid," month",o.monthsUntilPaid!==1?"s":""]})]})]})]})}const De={CREDIT_CARD:"Credit Card",AUTO_LOAN:"Auto Loan",STUDENT_LOAN:"Student Loan",PERSONAL_LOAN:"Personal Loan",BNPL:"BNPL",MORTGAGE:"Mortgage",OTHER:"Other"},Pe={CREDIT_CARD:U,AUTO_LOAN:me,STUDENT_LOAN:oe,PERSONAL_LOAN:ce,BNPL:de,MORTGAGE:le,OTHER:G},ve={CURRENT:"Current",DEFERRED:"Deferred",PAST_DUE:"Past Due",IN_COLLECTIONS:"In Collections",PAID_OFF:"Paid Off"};function R(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Number(s))}function Se(s){switch(s?.toLowerCase()){case"weekly":return 52/12;case"biweekly":return 26/12;case"yearly":return 1/12;case"monthly":default:return 1}}function Ce(s){const u=Number(s.currentBalance),x=Number(s.interestRate),j=Number(s.minimumPayment),m=s.type==="BNPL",N=s.status==="DEFERRED";if(m&&s.scheduledPayments&&s.scheduledPayments.length>0){const l=s.scheduledPayments.filter(a=>!a.isPaid);if(l.length===0)return{months:0,date:"Paid Off",method:"fixed"};const c=l[l.length-1],v=new Date(c.dueDate);return{months:l.length,date:v.toLocaleDateString("en-US",{month:"short",year:"numeric"}),method:"fixed"}}if(j<=0||u<=0)return{months:null,date:"N/A",method:"standard"};const o=Se(s.paymentFrequency),h=j*o;let f=u;if(N&&s.deferredUntil){const l=new Date(s.deferredUntil),c=new Date;if(l>c){const v=Math.ceil((l.getTime()-c.getTime())/2592e6),a=x/100/12;f=u*Math.pow(1+a,v)}}const p=x/100/12;if(p===0){const l=Math.ceil(f/h),c=new Date;return c.setMonth(c.getMonth()+l),{months:l,date:c.toLocaleDateString("en-US",{month:"short",year:"numeric"}),method:"no-interest"}}const g=f*p;if(h<=g)return{months:null,date:"Never (payment too low)",method:"standard"};const D=Math.ceil(Math.log(h/(h-f*p))/Math.log(1+p)),y=new Date;return y.setMonth(y.getMonth()+D),{months:D,date:y.toLocaleDateString("en-US",{month:"short",year:"numeric"}),method:"amortized"}}function Qe(){const[s,u]=b.useState([]),[x,j]=b.useState(!0),[m,N]=b.useState(null),[o,h]=b.useState(""),f=typeof window<"u"?new URLSearchParams(window.location.search):null,p=f?.get("sort"),g=f?.get("dir"),D=["name","interestRate","effectiveRate","currentBalance","dueDay","status"],[y,l]=b.useState(p&&D.includes(p)?p:"effectiveRate"),[c,v]=b.useState(g==="asc"||g==="desc"?g:"desc");b.useEffect(()=>{a()},[]);async function a(){const t=await fetch("/api/debts");if(t.ok){const n=await t.json(),i=await Promise.all(n.map(async d=>{const[w,C]=await Promise.all([fetch(`/api/debts/${d.id}/payments`),fetch(`/api/debts/${d.id}/scheduled-payments`)]),P=w.ok?await w.json():[],E=C.ok?await C.json():[];return{...d,payments:P,scheduledPayments:E}}));u(i)}j(!1)}function r(t){let n;y===t?n=c==="asc"?"desc":"asc":n=t==="name"?"asc":"desc",l(t),v(n);const i=new URLSearchParams(window.location.search);i.set("sort",t),i.set("dir",n),window.history.replaceState({},"",`/dashboard/debts?${i.toString()}`)}const S=s.filter(t=>{if(!o)return!0;const n=o.toLowerCase();return t.name.toLowerCase().includes(n)||t.type.toLowerCase().includes(n)||t.status.toLowerCase().includes(n)||(t.notes?.toLowerCase().includes(n)??!1)}),T=[...S].sort((t,n)=>{let i,d;switch(y){case"name":const w=t.name.localeCompare(n.name,void 0,{numeric:!0,sensitivity:"base"});return c==="asc"?w:-w;case"interestRate":i=Number(t.interestRate),d=Number(n.interestRate);break;case"effectiveRate":i=Math.max(Number(t.effectiveRate)||0,Number(t.interestRate)||0),d=Math.max(Number(n.effectiveRate)||0,Number(n.interestRate)||0);break;case"currentBalance":i=Number(t.currentBalance),d=Number(n.currentBalance);break;case"dueDay":i=t.dueDay,d=n.dueDay;break;case"status":i=t.status,d=n.status;break;default:return 0}return i<d?c==="asc"?-1:1:i>d?c==="asc"?1:-1:0});function M(){N(null),a()}async function O(t){if(!confirm("Are you sure you want to delete this debt?"))return;(await fetch(`/api/debts/${t}`,{method:"DELETE"})).ok&&u(s.filter(i=>i.id!==t))}const q=s.reduce((t,n)=>t+Number(n.currentBalance),0),H=s.filter(t=>t.type!=="BNPL"),V=s.filter(t=>t.type==="BNPL"),W=H.reduce((t,n)=>t+Number(n.minimumPayment),0),Y=V.reduce((t,n)=>{if(n.scheduledPayments&&n.scheduledPayments.length>0){const i=n.scheduledPayments.filter(P=>!P.isPaid);if(i.length===0)return t;const d=new Date,w=new Date(d.getTime()+720*60*60*1e3),C=i.filter(P=>new Date(P.dueDate)<=w);return t+C.reduce((P,E)=>P+Number(E.amount),0)}return t},0);if(x)return e.jsxs("div",{className:"space-y-6 lg:space-y-8 animate-fade-in",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-theme-primary tracking-tight",children:"Debts"}),e.jsx("p",{className:"text-theme-secondary mt-1",children:"Track and manage your debts"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(t=>e.jsx(B,{children:e.jsx(A,{className:"py-5",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-theme-tertiary rounded"}),e.jsx("div",{className:"h-8 w-32 bg-theme-tertiary rounded"})]})})},t))})]});const F=({field:t,label:n})=>e.jsxs("button",{onClick:()=>r(t),className:`
        flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium
        transition-all duration-200
        ${y===t?"bg-accent-600 text-white shadow-sm":"bg-theme-tertiary text-theme-secondary hover:bg-theme-secondary hover:text-theme-primary"}
      `,children:[n,e.jsx(Ne,{className:"h-3 w-3"})]});return e.jsxs("div",{className:"space-y-6 lg:space-y-8 animate-fade-in",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-theme-primary tracking-tight",children:"Debts"}),e.jsx("p",{className:"text-theme-secondary mt-1",children:"Track and manage your debts"})]}),e.jsx("a",{href:"/dashboard/debts/new",children:e.jsx(k,{leftIcon:e.jsx(z,{className:"h-4 w-4"}),children:"Add Debt"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(_,{label:"Total Debt",value:R(q),icon:e.jsx(U,{className:"h-5 w-5"}),variant:"danger"}),e.jsx(_,{label:"Monthly Payments",value:R(W),icon:e.jsx(re,{className:"h-5 w-5"}),variant:"info"}),e.jsx(_,{label:"BNPL Due This Month",value:R(Y),icon:e.jsx(ie,{className:"h-5 w-5"}),variant:"warning"})]}),s.length>0&&e.jsx(we,{debts:s}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(ne,{value:o,onChange:h,placeholder:"Search debts...",className:"sm:max-w-xs"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-theme-secondary text-sm font-medium",children:"Sort:"}),e.jsx(F,{field:"effectiveRate",label:"Effective Rate"}),e.jsx(F,{field:"interestRate",label:"APR"}),e.jsx(F,{field:"currentBalance",label:"Balance"}),e.jsx(F,{field:"name",label:"Name"})]})]}),s.length===0?e.jsx(B,{children:e.jsxs(A,{className:"py-16 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-theme-tertiary flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"h-8 w-8 text-theme-muted"})}),e.jsx("h3",{className:"text-lg font-semibold text-theme-primary mb-2",children:"No debts yet"}),e.jsx("p",{className:"text-theme-secondary mb-6",children:"Start tracking your debts to monitor your progress"}),e.jsx("a",{href:"/dashboard/debts/new",children:e.jsx(k,{leftIcon:e.jsx(z,{className:"h-4 w-4"}),children:"Add Your First Debt"})})]})}):S.length===0?e.jsx(B,{children:e.jsxs(A,{className:"py-16 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-theme-tertiary flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"h-8 w-8 text-theme-muted"})}),e.jsx("h3",{className:"text-lg font-semibold text-theme-primary mb-2",children:"No results found"}),e.jsxs("p",{className:"text-theme-secondary",children:['No debts match "',o,'"']})]})}):e.jsx("div",{className:"space-y-3",children:T.map((t,n)=>{const i=Number(t.currentBalance),d=Number(t.originalBalance),w=Number(t.interestRate),C=Number(t.effectiveRate)||0,P=Math.max(C,w),E=d>0?(d-i)/d*100:0,Q=Ce(t),I=t.type==="BNPL",J=I&&C>0&&C!==w,X=Pe[t.type]||G,$=t.status==="PAST_DUE"||t.status==="IN_COLLECTIONS";return e.jsx(B,{className:`animate-fade-in-up stagger-${Math.min(n+1,5)} ${$?"border-danger-300 dark:border-danger-600/50 bg-danger-50/50 dark:bg-danger-600/5":""}`,children:e.jsxs(A,{className:"py-5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2.5 rounded-lg bg-theme-tertiary shrink-0",children:e.jsx(X,{className:"h-5 w-5 text-theme-secondary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("a",{href:`/dashboard/debts/${t.id}`,className:"group",children:e.jsx("h3",{className:"font-semibold text-theme-primary group-hover:text-accent-600 transition-colors truncate",children:t.name})}),e.jsxs("p",{className:"text-sm text-theme-muted",children:[De[t.type]||t.type,P>0&&` · ${J?`~${C.toFixed(1)}%`:`${w}%`} APR`,I&&P===0&&" · 0% APR",t.status!=="CURRENT"&&` · ${ve[t.status]}`]})]}),e.jsx("div",{className:"text-right shrink-0",children:$?e.jsxs("div",{className:"px-3 py-1.5 rounded-lg bg-danger-100 dark:bg-danger-600/20 border border-danger-200 dark:border-danger-600/30",children:[e.jsx("p",{className:"text-lg font-bold text-danger-700 dark:text-danger-400",children:R(i)}),t.pastDueAmount?e.jsxs("p",{className:"text-xs text-danger-600 dark:text-danger-400 font-medium",children:[R(Number(t.pastDueAmount))," PAST DUE"]}):e.jsx("p",{className:"text-xs text-danger-600 dark:text-danger-400",children:"PAST DUE"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg font-bold text-theme-primary",children:R(i)}),e.jsxs("p",{className:"text-xs text-theme-muted",children:[R(Number(t.minimumPayment)),"/mo"]})]})}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>N(t),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("a",{href:`/dashboard/debts/${t.id}/edit?sort=${y}&dir=${c}`,children:e.jsx(k,{variant:"ghost",size:"sm",children:e.jsx(ue,{className:"h-4 w-4"})})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>O(t.id),children:e.jsx(xe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-theme-muted mb-1.5",children:[e.jsxs("span",{children:[E.toFixed(0),"% paid off"]}),e.jsxs("span",{children:["Payoff: ",Q.date]})]}),e.jsx("div",{className:"progress-bar h-1.5",children:e.jsx("div",{className:"progress-bar-fill",style:{width:`${Math.min(E,100)}%`}})})]}),I&&t.scheduledPayments&&t.scheduledPayments.filter(L=>!L.isPaid).length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-theme",children:e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsx("span",{className:"text-theme-muted",children:"Next payments:"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:t.scheduledPayments.filter(L=>!L.isPaid).slice(0,3).map(L=>e.jsxs("span",{className:"text-theme-secondary",children:[new Date(L.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric"}),e.jsx("span",{className:"text-theme-primary font-medium ml-1",children:R(Number(L.amount))})]},L.id))})]})}),t.status==="DEFERRED"&&t.deferredUntil&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-theme-muted",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Deferred until ",new Date(t.deferredUntil).toLocaleDateString()]})]})]})},t.id)})}),m&&e.jsx(ge,{debtId:m.id,debtName:m.name,currentBalance:Number(m.currentBalance),minimumPayment:Number(m.minimumPayment),onClose:M})]})}export{Qe as default};
//# sourceMappingURL=debts-page-content.D9_z6krM.js.map
