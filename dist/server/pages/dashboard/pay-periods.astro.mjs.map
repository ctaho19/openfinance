{"version":3,"file":"pay-periods.astro.mjs","sources":["../../../../src/pages/dashboard/pay-periods/index.astro"],"sourcesContent":["---\nimport DashboardLayout from '../../../layouts/DashboardLayout.astro';\nimport { SectionCard } from '../../../components/ui/section-card';\nimport { getSession } from '../../../lib/get-session-astro';\nimport { getCurrentPayPeriod, formatPayPeriod, getPaymentsForPeriod } from '../../../lib/services/pay-periods';\nimport { startOfDay, endOfDay, differenceInDays, isToday, isTomorrow, format } from 'date-fns';\nimport { Calendar, CheckCircle2, Circle, DollarSign } from 'lucide-react';\n\nconst session = await getSession(Astro.request);\nif (!session?.user?.id) {\n  return Astro.redirect('/login');\n}\n\nconst currentPeriod = getCurrentPayPeriod();\nconst periodStart = startOfDay(currentPeriod.startDate);\nconst periodEnd = endOfDay(currentPeriod.endDate);\n\nconst payments = await getPaymentsForPeriod(session.user.id, periodStart, periodEnd);\n\nconst paidPayments = payments.filter(p => p.status === 'PAID');\nconst unpaidPayments = payments.filter(p => p.status === 'UNPAID');\n\nconst totalDue = payments.reduce((sum, p) => sum + Number(p.amount), 0);\nconst totalPaid = paidPayments.reduce((sum, p) => sum + Number(p.amount), 0);\n\nfunction formatDueDate(date: Date): string {\n  if (isToday(date)) return \"Today\";\n  if (isTomorrow(date)) return \"Tomorrow\";\n  const days = differenceInDays(date, new Date());\n  if (days < 0) return `${Math.abs(days)}d overdue`;\n  return format(date, \"MMM d\");\n}\n---\n<DashboardLayout title=\"Pay Periods\" currentPath=\"/dashboard/pay-periods\" user={session.user} showExploreSidebar={false}>\n  <div class=\"space-y-6\">\n    <header>\n      <h1 class=\"text-2xl font-bold text-theme-primary\">Pay Period</h1>\n      <p class=\"text-theme-secondary mt-1\">{formatPayPeriod(currentPeriod)}</p>\n    </header>\n\n    <!-- Summary Cards -->\n    <div class=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\n      <div class=\"bg-theme-elevated rounded-2xl border border-theme p-4\">\n        <p class=\"text-label\">Total Due</p>\n        <p class=\"text-2xl font-semibold text-theme-primary mt-1\">\n          ${totalDue.toLocaleString(undefined, { minimumFractionDigits: 2 })}\n        </p>\n      </div>\n      <div class=\"bg-theme-elevated rounded-2xl border border-theme p-4\">\n        <p class=\"text-label\">Paid</p>\n        <p class=\"text-2xl font-semibold text-success-600 mt-1\">\n          ${totalPaid.toLocaleString(undefined, { minimumFractionDigits: 2 })}\n        </p>\n      </div>\n      <div class=\"bg-theme-elevated rounded-2xl border border-theme p-4\">\n        <p class=\"text-label\">Remaining</p>\n        <p class=\"text-2xl font-semibold text-theme-primary mt-1\">\n          ${(totalDue - totalPaid).toLocaleString(undefined, { minimumFractionDigits: 2 })}\n        </p>\n      </div>\n      <div class=\"bg-theme-elevated rounded-2xl border border-theme p-4\">\n        <p class=\"text-label\">Bills</p>\n        <p class=\"text-2xl font-semibold text-theme-primary mt-1\">\n          {paidPayments.length}/{payments.length}\n        </p>\n      </div>\n    </div>\n\n    <!-- Unpaid Bills -->\n    {unpaidPayments.length > 0 && (\n      <SectionCard client:visible title=\"Unpaid\" subtitle={`${unpaidPayments.length} remaining`}>\n        <div class=\"divide-y divide-theme\">\n          {unpaidPayments.map((payment) => (\n            <div class=\"flex items-center justify-between py-3 first:pt-0 last:pb-0 group\">\n              <div class=\"flex items-center gap-3\">\n                <button\n                  data-payment-id={payment.id}\n                  class=\"payment-toggle p-1 rounded-full hover:bg-theme-secondary/50 transition-colors\"\n                >\n                  <Circle className=\"h-5 w-5 text-theme-muted\" />\n                </button>\n                <div>\n                  <p class=\"font-medium text-theme-primary\">{payment.bill.name}</p>\n                  <p class=\"text-sm text-theme-muted\">{formatDueDate(payment.dueDate)}</p>\n                </div>\n              </div>\n              <span class=\"font-semibold text-theme-primary\">\n                ${Number(payment.amount).toLocaleString(undefined, { minimumFractionDigits: 2 })}\n              </span>\n            </div>\n          ))}\n        </div>\n      </SectionCard>\n    )}\n\n    <!-- Paid Bills -->\n    {paidPayments.length > 0 && (\n      <SectionCard client:visible title=\"Paid\" subtitle={`${paidPayments.length} completed`} defaultOpen={false}>\n        <div class=\"divide-y divide-theme\">\n          {paidPayments.map((payment) => (\n            <div class=\"flex items-center justify-between py-3 first:pt-0 last:pb-0 opacity-60\">\n              <div class=\"flex items-center gap-3\">\n                <button\n                  data-payment-id={payment.id}\n                  class=\"payment-toggle p-1 rounded-full hover:bg-theme-secondary/50 transition-colors\"\n                >\n                  <CheckCircle2 className=\"h-5 w-5 text-success-600\" />\n                </button>\n                <div>\n                  <p class=\"font-medium text-theme-primary line-through\">{payment.bill.name}</p>\n                  <p class=\"text-sm text-theme-muted\">{formatDueDate(payment.dueDate)}</p>\n                </div>\n              </div>\n              <span class=\"font-semibold text-theme-primary\">\n                ${Number(payment.amount).toLocaleString(undefined, { minimumFractionDigits: 2 })}\n              </span>\n            </div>\n          ))}\n        </div>\n      </SectionCard>\n    )}\n  </div>\n\n  <script>\n    document.querySelectorAll('.payment-toggle').forEach(button => {\n      button.addEventListener('click', async () => {\n        const paymentId = (button as HTMLElement).dataset.paymentId;\n        try {\n          const response = await fetch(`/api/bill-payments/${paymentId}`, {\n            method: 'PATCH',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ togglePaid: true }),\n          });\n          if (response.ok) {\n            window.location.reload();\n          }\n        } catch (error) {\n          console.error('Failed to toggle payment:', error);\n        }\n      });\n    });\n  </script>\n</DashboardLayout>\n"],"names":["$$createAstro","$$createComponent","Astro","$$render","$$renderComponent","DashboardLayout","$$result","$$maybeRenderHead","$$addAttribute","$$renderScript"],"mappings":"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"}