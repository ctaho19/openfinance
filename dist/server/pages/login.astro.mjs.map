{"version":3,"file":"login.astro.mjs","sources":["../../../src/pages/login.astro"],"sourcesContent":["---\nimport BaseLayout from '../layouts/BaseLayout.astro';\nimport { getSession } from '../lib/get-session-astro';\n\n// Redirect if already logged in\nconst session = await getSession(Astro.request);\nif (session?.user?.id) {\n  return Astro.redirect('/dashboard');\n}\n\n// Check for error in URL\nconst error = Astro.url.searchParams.get('error');\n---\n<BaseLayout title=\"Sign in\">\n  <div class=\"min-h-screen bg-[#f5f6f7] flex flex-col\">\n    <!-- Header bar - Chase style -->\n    <header class=\"bg-[#0a3254] py-4\">\n      <div class=\"max-w-7xl mx-auto px-6 flex items-center justify-between\">\n        <a href=\"/\" class=\"flex items-center gap-2\">\n          <div class=\"w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center\">\n            <span class=\"text-white font-bold text-sm\">OF</span>\n          </div>\n          <span class=\"text-white font-semibold text-lg hidden sm:block\">OpenFinance</span>\n        </a>\n        <nav class=\"flex items-center gap-6 text-sm text-white/80\">\n          <a href=\"/\" class=\"hover:text-white transition-colors\">Personal</a>\n          <a href=\"/\" class=\"hover:text-white transition-colors\">Business</a>\n        </nav>\n      </div>\n    </header>\n    \n    <!-- Main content -->\n    <main class=\"flex-1 flex items-center justify-center px-4 py-12\">\n      <div class=\"w-full max-w-sm\">\n        <div class=\"bg-white rounded-xl shadow-lg border border-gray-200 p-8\">\n          <h1 class=\"text-xl font-semibold text-gray-900 mb-6\">Welcome back</h1>\n          \n          <div id=\"error-message\" class=\"hidden mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm\">\n          </div>\n          \n          {error && (\n            <div class=\"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm\">\n              {error === 'CredentialsSignin' ? 'Invalid email or password' : 'An error occurred. Please try again.'}\n            </div>\n          )}\n          \n          <form id=\"login-form\" class=\"space-y-5\">\n            <div>\n              <label for=\"email\" class=\"block text-sm font-medium text-gray-700 mb-1.5\">\n                Username\n              </label>\n              <input\n                type=\"email\"\n                id=\"email\"\n                name=\"email\"\n                required\n                class=\"w-full px-4 py-3 rounded-lg border border-gray-300 bg-gray-50 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[#0060f0]/20 focus:border-[#0060f0] transition-all\"\n                placeholder=\"you@example.com\"\n              />\n            </div>\n            <div>\n              <label for=\"password\" class=\"block text-sm font-medium text-gray-700 mb-1.5\">\n                Password\n              </label>\n              <div class=\"relative\">\n                <input\n                  type=\"password\"\n                  id=\"password\"\n                  name=\"password\"\n                  required\n                  class=\"w-full px-4 py-3 rounded-lg border border-gray-300 bg-gray-50 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[#0060f0]/20 focus:border-[#0060f0] transition-all pr-16\"\n                  placeholder=\"••••••••\"\n                />\n                <button\n                  type=\"button\"\n                  class=\"absolute right-3 top-1/2 -translate-y-1/2 text-[#0060f0] text-sm font-medium hover:text-[#004dc0]\"\n                  onclick=\"togglePassword()\"\n                >\n                  Show\n                </button>\n              </div>\n            </div>\n            \n            <div class=\"flex items-center justify-between text-sm\">\n              <label class=\"flex items-center gap-2 cursor-pointer\">\n                <input type=\"checkbox\" class=\"w-4 h-4 rounded border-gray-300 text-[#0060f0] focus:ring-[#0060f0]\" />\n                <span class=\"text-gray-600\">Remember me</span>\n              </label>\n              <a href=\"#\" class=\"text-[#0060f0] hover:text-[#004dc0] font-medium\">\n                Use token\n                <span class=\"ml-0.5\">›</span>\n              </a>\n            </div>\n            \n            <button\n              type=\"submit\"\n              id=\"submit-btn\"\n              class=\"w-full py-3 bg-[#0060f0] hover:bg-[#004dc0] text-white rounded-lg font-semibold transition-colors disabled:opacity-50\"\n            >\n              Sign in\n            </button>\n          </form>\n          \n          <div class=\"mt-6 pt-5 border-t border-gray-200 space-y-3 text-sm\">\n            <a href=\"#\" class=\"block text-[#0060f0] hover:text-[#004dc0]\">\n              Forgot username/password?\n              <span class=\"ml-0.5\">›</span>\n            </a>\n            <a href=\"#\" class=\"block text-[#0060f0] hover:text-[#004dc0]\">\n              Not Enrolled? Sign Up Now.\n              <span class=\"ml-0.5\">›</span>\n            </a>\n          </div>\n        </div>\n      </div>\n    </main>\n    \n    <!-- Footer -->\n    <footer class=\"py-6 border-t border-gray-200 bg-white\">\n      <div class=\"max-w-7xl mx-auto px-6 text-center text-sm text-gray-500\">\n        © 2024 OpenFinance. All rights reserved.\n      </div>\n    </footer>\n  </div>\n</BaseLayout>\n\n<script>\n  function togglePassword() {\n    const input = document.getElementById('password') as HTMLInputElement;\n    const btn = event?.target as HTMLButtonElement;\n    if (input.type === 'password') {\n      input.type = 'text';\n      btn.textContent = 'Hide';\n    } else {\n      input.type = 'password';\n      btn.textContent = 'Show';\n    }\n  }\n  (window as unknown as { togglePassword: typeof togglePassword }).togglePassword = togglePassword;\n\n  const form = document.getElementById('login-form') as HTMLFormElement;\n  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;\n  const errorDiv = document.getElementById('error-message') as HTMLDivElement;\n  \n  function showError(message: string) {\n    errorDiv.textContent = message;\n    errorDiv.classList.remove('hidden');\n  }\n  \n  form?.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Signing in...';\n    errorDiv.classList.add('hidden');\n    \n    try {\n      // First, get CSRF token\n      const csrfRes = await fetch('/api/auth/csrf');\n      const { csrfToken } = await csrfRes.json();\n      \n      const formData = new FormData(form);\n      formData.append('csrfToken', csrfToken);\n      \n      // Submit to credentials callback\n      const res = await fetch('/api/auth/callback/credentials', {\n        method: 'POST',\n        body: new URLSearchParams(formData as unknown as Record<string, string>),\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        credentials: 'include',\n      });\n      \n      // Check if the response indicates an error\n      const url = new URL(res.url);\n      if (url.searchParams.has('error')) {\n        const error = url.searchParams.get('error');\n        if (error === 'CredentialsSignin') {\n          showError('Invalid email or password');\n        } else {\n          showError('An error occurred. Please try again.');\n        }\n        submitBtn.disabled = false;\n        submitBtn.textContent = 'Sign in';\n        return;\n      }\n      \n      // Success - redirect to dashboard\n      window.location.href = '/dashboard';\n    } catch (err) {\n      console.error('Login error:', err);\n      showError('An error occurred. Please try again.');\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Sign in';\n    }\n  });\n</script>\n"],"names":["$$createAstro","$$createComponent","Astro","$$render","$$renderComponent","BaseLayout","$$result","$$maybeRenderHead","$$renderScript"],"mappings":";;;;;;AAAA,MAAA,UAAAA,WAAA,EAAA;AAAA,MAAA,OAAA,GAAAC,eAAA,CAAA,OAAA,QAAA,EAAA,SAAA,OAAA,KAAA;AAAA,EAAA,MAAAC,MAAAA,GAAA,QAAA,CAAA,WAAA,CAAA,OAAA,EAAA,SAAA,OAAA,CAAA;AAAA,EAAAA,OAAA,IAAA,GAAA,OAAA;AAKA,EAAA,MAAM,OAAA,GAAU,MAAM,UAAA,CAAWA,MAAAA,CAAM,OAAO,CAAA;AAC9C,EAAA,IAAI,OAAA,EAAS,MAAM,EAAA,EAAI;AACrB,IAAA,OAAOA,MAAAA,CAAM,SAAS,YAAY,CAAA;AACpC,EAAA;AAGA,EAAA,MAAM,KAAA,GAAQA,MAAAA,CAAM,GAAA,CAAI,YAAA,CAAa,IAAI,OAAO,CAAA;AAXhD,EAAA,OAAAC,cAAA,CAAA,EAAAC,eAAA,CAAA,QAAA,EAAA,YAAA,EAAAC,YAAA,EAAA,EAaY,OAAA,EAbZ,SAAA,EAAA,EAAA,EAAA,SAAA,EAAA,OAAAC,cAAAH,cAAA,CAAA,CAAA,EAAAI,eAAA,CAAA,CAAA,CAAA,uiCAAA,EAwCW,KAAA,IAxCXJ,wGA0Ce,KAAA,KAAU,mBAAA,GAAsB,2BAAA,GAA8B,sCAAsC,CAAA,OAAA,CAExG,CAAA;;;;;;;;;;;;;;;;AA5CX,wBAAA,CAAA,EA4HE,CAAA,CAAA,CAAA,EA5HFK,YAAA,CAAA,QAAA,EAAA,+FAAA,CAAA,CAAA,CAAA;AAAA,CAAA,EAAA,+DAAA,MAAA,CAAA;;;;;;;;;;;;;;;;"}