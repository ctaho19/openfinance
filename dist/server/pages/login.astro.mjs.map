{"version":3,"file":"login.astro.mjs","sources":["../../../src/pages/login.astro"],"sourcesContent":["---\nimport BaseLayout from '../layouts/BaseLayout.astro';\nimport { getSession } from '../lib/get-session-astro';\n\n// Redirect if already logged in\nconst session = await getSession(Astro.request);\nif (session?.user?.id) {\n  return Astro.redirect('/dashboard');\n}\n\n// Check for error in URL\nconst error = Astro.url.searchParams.get('error');\n---\n<BaseLayout title=\"Login\">\n  <div class=\"min-h-screen bg-theme-secondary flex items-center justify-center px-4\">\n    <div class=\"w-full max-w-md\">\n      <div class=\"text-center mb-8\">\n        <div class=\"w-16 h-16 rounded-2xl bg-chase-gradient flex items-center justify-center mx-auto mb-4 shadow-lg\">\n          <span class=\"text-white font-bold text-2xl\">OF</span>\n        </div>\n        <h1 class=\"text-2xl font-bold text-theme-primary\">Welcome to OpenFinance</h1>\n        <p class=\"text-theme-secondary mt-2\">Sign in to manage your finances</p>\n      </div>\n      \n      <div class=\"bg-theme-elevated rounded-2xl border border-theme shadow-theme p-6\">\n        <div id=\"error-message\" class=\"hidden mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm\">\n        </div>\n        \n        {error && (\n          <div class=\"mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm\">\n            {error === 'CredentialsSignin' ? 'Invalid email or password' : 'An error occurred. Please try again.'}\n          </div>\n        )}\n        \n        <form id=\"login-form\" class=\"space-y-4\">\n          <div>\n            <label for=\"email\" class=\"block text-sm font-medium text-theme-primary mb-1.5\">\n              Email\n            </label>\n            <input\n              type=\"email\"\n              id=\"email\"\n              name=\"email\"\n              required\n              class=\"w-full px-4 py-2.5 rounded-xl border border-theme bg-theme-primary text-theme-primary placeholder:text-theme-muted focus:outline-none focus:ring-2 focus:ring-accent-500 focus:border-transparent transition-colors\"\n              placeholder=\"you@example.com\"\n            />\n          </div>\n          <div>\n            <label for=\"password\" class=\"block text-sm font-medium text-theme-primary mb-1.5\">\n              Password\n            </label>\n            <input\n              type=\"password\"\n              id=\"password\"\n              name=\"password\"\n              required\n              class=\"w-full px-4 py-2.5 rounded-xl border border-theme bg-theme-primary text-theme-primary placeholder:text-theme-muted focus:outline-none focus:ring-2 focus:ring-accent-500 focus:border-transparent transition-colors\"\n              placeholder=\"••••••••\"\n            />\n          </div>\n          <button\n            type=\"submit\"\n            id=\"submit-btn\"\n            class=\"w-full py-3 bg-accent-600 hover:bg-accent-700 text-white rounded-xl font-semibold transition-colors disabled:opacity-50\"\n          >\n            Sign In\n          </button>\n        </form>\n      </div>\n    </div>\n  </div>\n</BaseLayout>\n\n<script>\n  const form = document.getElementById('login-form') as HTMLFormElement;\n  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;\n  const errorDiv = document.getElementById('error-message') as HTMLDivElement;\n  \n  function showError(message: string) {\n    errorDiv.textContent = message;\n    errorDiv.classList.remove('hidden');\n  }\n  \n  form?.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Signing in...';\n    errorDiv.classList.add('hidden');\n    \n    try {\n      // First, get CSRF token\n      const csrfRes = await fetch('/api/auth/csrf');\n      const { csrfToken } = await csrfRes.json();\n      \n      const formData = new FormData(form);\n      formData.append('csrfToken', csrfToken);\n      \n      // Submit to credentials callback\n      const res = await fetch('/api/auth/callback/credentials', {\n        method: 'POST',\n        body: new URLSearchParams(formData as unknown as Record<string, string>),\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        credentials: 'include',\n      });\n      \n      // Check if the response indicates an error\n      const url = new URL(res.url);\n      if (url.searchParams.has('error')) {\n        const error = url.searchParams.get('error');\n        if (error === 'CredentialsSignin') {\n          showError('Invalid email or password');\n        } else {\n          showError('An error occurred. Please try again.');\n        }\n        submitBtn.disabled = false;\n        submitBtn.textContent = 'Sign In';\n        return;\n      }\n      \n      // Success - redirect to dashboard\n      window.location.href = '/dashboard';\n    } catch (err) {\n      console.error('Login error:', err);\n      showError('An error occurred. Please try again.');\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Sign In';\n    }\n  });\n</script>\n"],"names":["$$createAstro","$$createComponent","Astro","$$render","$$renderComponent","BaseLayout","$$result","$$maybeRenderHead","$$renderScript"],"mappings":";;;;;;AAAA,MAAA,UAAAA,WAAA,EAAA;AAAA,MAAA,OAAA,GAAAC,eAAA,CAAA,OAAA,QAAA,EAAA,SAAA,OAAA,KAAA;AAAA,EAAA,MAAAC,MAAAA,GAAA,QAAA,CAAA,WAAA,CAAA,OAAA,EAAA,SAAA,OAAA,CAAA;AAAA,EAAAA,OAAA,IAAA,GAAA,OAAA;AAKA,EAAA,MAAM,OAAA,GAAU,MAAM,UAAA,CAAWA,MAAAA,CAAM,OAAO,CAAA;AAC9C,EAAA,IAAI,OAAA,EAAS,MAAM,EAAA,EAAI;AACrB,IAAA,OAAOA,MAAAA,CAAM,SAAS,YAAY,CAAA;AACpC,EAAA;AAGA,EAAA,MAAM,KAAA,GAAQA,MAAAA,CAAM,GAAA,CAAI,YAAA,CAAa,IAAI,OAAO,CAAA;AAXhD,EAAA,OAAAC,cAAA,CAAA,EAAAC,eAAA,CAAA,QAAA,EAAA,YAAA,EAAAC,YAAA,EAAA,EAaY,OAAA,EAbZ,OAAA,EAAA,EAAA,EAAA,SAAA,EAAA,OAAAC,cAAAH,cAAA,CAAA,CAAA,EAAAI,eAAA,CAAA,CAAA,CAAA,mqBAAA,EA4BS,KAAA,IA5BTJ,yGA8Ba,KAAA,KAAU,mBAAA,GAAsB,2BAAA,GAA8B,sCAAsC,CAAA,OAAA,CAExG,CAAA;;;;;;AAhCT,uCAAA,CAAA,EAwEE,CAAA,CAAA,CAAA,EAxEFK,YAAA,CAAA,QAAA,EAAA,+FAAA,CAAA,CAAA,CAAA;AAAA,CAAA,EAAA,+DAAA,MAAA,CAAA;;;;;;;;;;;;;;;;"}