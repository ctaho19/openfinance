{"version":3,"file":"_---auth_.astro.mjs","sources":["../../../../../src/pages/api/auth/[...auth].ts"],"sourcesContent":["import { Auth, type AuthConfig } from \"@auth/core\";\nimport type { Session } from \"@auth/core/types\";\nimport { authConfig, getAuthSecret, IDLE_TIMEOUT_SECONDS } from \"../../../lib/auth-config\";\nimport type { APIRoute } from \"astro\";\n\nconst config: AuthConfig = {\n  ...authConfig,\n  secret: getAuthSecret(),\n  trustHost: true,\n  basePath: \"/api/auth\",\n  callbacks: {\n    async jwt({ token, user }) {\n      const now = Math.floor(Date.now() / 1000);\n      if (user) {\n        token.id = user.id;\n        token.lastActivity = now;\n        return token;\n      }\n      const lastActivity = (token.lastActivity as number) || now;\n      if (now - lastActivity > IDLE_TIMEOUT_SECONDS) {\n        return {};\n      }\n      token.lastActivity = now;\n      return token;\n    },\n    async session({ session, token }) {\n      if (!token.id) {\n        return {} as Session;\n      }\n      if (session.user && token.id) {\n        (session.user as { id?: string }).id = token.id as string;\n      }\n      return session;\n    },\n  },\n};\n\nexport const ALL: APIRoute = async ({ request }) => {\n  return Auth(request, config);\n};\n"],"names":[],"mappings":";;;;AAKA,MAAM,MAAA,GAAqB;AAAA,EACzB,GAAG,UAAA;AAAA,EACH,QAAQ,aAAA,EAAc;AAAA,EACtB,SAAA,EAAW,IAAA;AAAA,EACX,QAAA,EAAU,WAAA;AAAA,EACV,SAAA,EAAW;AAAA,IACT,MAAM,GAAA,CAAI,EAAE,KAAA,EAAO,MAAK,EAAG;AACzB,MAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAA,KAAQ,GAAI,CAAA;AACxC,MAAA,IAAI,IAAA,EAAM;AACR,QAAA,KAAA,CAAM,KAAK,IAAA,CAAK,EAAA;AAChB,QAAA,KAAA,CAAM,YAAA,GAAe,GAAA;AACrB,QAAA,OAAO,KAAA;AAAA,MACT;AACA,MAAA,MAAM,YAAA,GAAgB,MAAM,YAAA,IAA2B,GAAA;AACvD,MAAA,IAAI,GAAA,GAAM,eAAe,oBAAA,EAAsB;AAC7C,QAAA,OAAO,EAAC;AAAA,MACV;AACA,MAAA,KAAA,CAAM,YAAA,GAAe,GAAA;AACrB,MAAA,OAAO,KAAA;AAAA,IACT,CAAA;AAAA,IACA,MAAM,OAAA,CAAQ,EAAE,OAAA,EAAS,OAAM,EAAG;AAChC,MAAA,IAAI,CAAC,MAAM,EAAA,EAAI;AACb,QAAA,OAAO,EAAC;AAAA,MACV;AACA,MAAA,IAAI,OAAA,CAAQ,IAAA,IAAQ,KAAA,CAAM,EAAA,EAAI;AAC5B,QAAC,OAAA,CAAQ,IAAA,CAAyB,EAAA,GAAK,KAAA,CAAM,EAAA;AAAA,MAC/C;AACA,MAAA,OAAO,OAAA;AAAA,IACT;AAAA;AAEJ,CAAA;AAEO,MAAM,GAAA,GAAgB,OAAO,EAAE,OAAA,EAAQ,KAAM;AAClD,EAAA,OAAO,IAAA,CAAK,SAAS,MAAM,CAAA;AAC7B,CAAA;;;;;;;;;;;"}