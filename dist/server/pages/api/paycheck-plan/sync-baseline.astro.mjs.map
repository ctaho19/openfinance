{"version":3,"file":"sync-baseline.astro.mjs","sources":["../../../../../src/pages/api/paycheck-plan/sync-baseline.ts"],"sourcesContent":["import type { APIRoute } from \"astro\";\nimport { getSession } from \"../../../lib/get-session-astro\";\nimport { recalculatePayoffBaseline, getCurrentDebtTotal } from \"../../../lib/services/dollar-allocation-plan\";\nimport { apiResponse, apiError } from \"../../../lib/api-utils\";\n\nexport const GET: APIRoute = async ({ request }) => {\n  const session = await getSession(request);\n  if (!session?.user?.id) {\n    return apiError(\"Unauthorized\", 401);\n  }\n\n  try {\n    const currentTotal = await getCurrentDebtTotal(session.user.id);\n    return apiResponse({ currentDebtTotal: currentTotal });\n  } catch (error) {\n    console.error(\"Error getting current debt total:\", error);\n    return apiError(\n      error instanceof Error ? error.message : \"Failed to get debt total\",\n      500\n    );\n  }\n};\n\nexport const POST: APIRoute = async ({ request }) => {\n  const session = await getSession(request);\n  if (!session?.user?.id) {\n    return apiError(\"Unauthorized\", 401);\n  }\n\n  try {\n    const body = await request.json().catch(() => ({}));\n    const preserveStartDate = body.preserveStartDate ?? false;\n\n    const result = await recalculatePayoffBaseline(session.user.id, {\n      preserveStartDate,\n    });\n\n    return apiResponse({\n      success: true,\n      ...result,\n      previousStartDate: result.previousStartDate?.toISOString() ?? null,\n      newStartDate: result.newStartDate.toISOString(),\n    });\n  } catch (error) {\n    console.error(\"Error syncing baseline:\", error);\n    return apiError(\n      error instanceof Error ? error.message : \"Failed to sync baseline\",\n      500\n    );\n  }\n};\n"],"names":[],"mappings":";;;;;AAKO,MAAM,GAAA,GAAgB,OAAO,EAAE,OAAA,EAAQ,KAAM;AAClD,EAAA,MAAM,OAAA,GAAU,MAAM,UAAA,CAAW,OAAO,CAAA;AACxC,EAAA,IAAI,CAAC,OAAA,EAAS,IAAA,EAAM,EAAA,EAAI;AACtB,IAAA,OAAO,QAAA,CAAS,gBAAgB,GAAG,CAAA;AAAA,EACrC;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,YAAA,GAAe,MAAM,mBAAA,CAAoB,OAAA,CAAQ,KAAK,EAAE,CAAA;AAC9D,IAAA,OAAO,WAAA,CAAY,EAAE,gBAAA,EAAkB,YAAA,EAAc,CAAA;AAAA,EACvD,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,qCAAqC,KAAK,CAAA;AACxD,IAAA,OAAO,QAAA;AAAA,MACL,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,0BAAA;AAAA,MACzC;AAAA,KACF;AAAA,EACF;AACF,CAAA;AAEO,MAAM,IAAA,GAAiB,OAAO,EAAE,OAAA,EAAQ,KAAM;AACnD,EAAA,MAAM,OAAA,GAAU,MAAM,UAAA,CAAW,OAAO,CAAA;AACxC,EAAA,IAAI,CAAC,OAAA,EAAS,IAAA,EAAM,EAAA,EAAI;AACtB,IAAA,OAAO,QAAA,CAAS,gBAAgB,GAAG,CAAA;AAAA,EACrC;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,IAAA,GAAO,MAAM,OAAA,CAAQ,IAAA,GAAO,KAAA,CAAM,OAAO,EAAC,CAAE,CAAA;AAClD,IAAA,MAAM,iBAAA,GAAoB,KAAK,iBAAA,IAAqB,KAAA;AAEpD,IAAA,MAAM,MAAA,GAAS,MAAM,yBAAA,CAA0B,OAAA,CAAQ,KAAK,EAAA,EAAI;AAAA,MAC9D;AAAA,KACD,CAAA;AAED,IAAA,OAAO,WAAA,CAAY;AAAA,MACjB,OAAA,EAAS,IAAA;AAAA,MACT,GAAG,MAAA;AAAA,MACH,iBAAA,EAAmB,MAAA,CAAO,iBAAA,EAAmB,WAAA,EAAY,IAAK,IAAA;AAAA,MAC9D,YAAA,EAAc,MAAA,CAAO,YAAA,CAAa,WAAA;AAAY,KAC/C,CAAA;AAAA,EACH,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,2BAA2B,KAAK,CAAA;AAC9C,IAAA,OAAO,QAAA;AAAA,MACL,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,yBAAA;AAAA,MACzC;AAAA,KACF;AAAA,EACF;AACF,CAAA;;;;;;;;;;;;"}