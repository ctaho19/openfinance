{"version":3,"file":"_id_.astro.mjs","sources":["../../../../../src/pages/api/debts/[id].ts"],"sourcesContent":["import type { APIRoute } from \"astro\";\nimport { getSession } from \"../../../lib/get-session-astro\";\nimport { getDebt, updateDebt } from \"../../../lib/services/debts\";\nimport { prisma } from \"../../../lib/db\";\nimport { apiResponse, apiError } from \"../../../lib/api-utils\";\n\nexport const GET: APIRoute = async ({ request, params }) => {\n  const session = await getSession(request);\n  if (!session?.user?.id) {\n    return apiError(\"Unauthorized\", 401);\n  }\n\n  const { id } = params;\n  if (!id) {\n    return apiError(\"Debt ID required\", 400);\n  }\n\n  const debt = await getDebt(session.user.id, id);\n  if (!debt) {\n    return apiError(\"Debt not found\", 404);\n  }\n\n  return apiResponse(debt);\n};\n\nexport const PATCH: APIRoute = async ({ request, params }) => {\n  const session = await getSession(request);\n  if (!session?.user?.id) {\n    return apiError(\"Unauthorized\", 401);\n  }\n\n  const { id } = params;\n  if (!id) {\n    return apiError(\"Debt ID required\", 400);\n  }\n\n  try {\n    const body = await request.json();\n    const debt = await updateDebt(session.user.id, id, body);\n    return apiResponse(debt);\n  } catch (error) {\n    return apiError(error instanceof Error ? error.message : \"Failed to update debt\", 400);\n  }\n};\n\nexport const DELETE: APIRoute = async ({ request, params }) => {\n  const session = await getSession(request);\n  if (!session?.user?.id) {\n    return apiError(\"Unauthorized\", 401);\n  }\n\n  const { id } = params;\n  if (!id) {\n    return apiError(\"Debt ID required\", 400);\n  }\n\n  try {\n    const existing = await prisma.debt.findFirst({\n      where: { id, userId: session.user.id },\n    });\n\n    if (!existing) {\n      return apiError(\"Debt not found\", 404);\n    }\n\n    await prisma.debt.update({\n      where: { id },\n      data: { isActive: false },\n    });\n\n    return apiResponse({ success: true });\n  } catch (error) {\n    return apiError(error instanceof Error ? error.message : \"Failed to delete debt\", 400);\n  }\n};\n"],"names":[],"mappings":"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"}