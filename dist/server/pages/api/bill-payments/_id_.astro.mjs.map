{"version":3,"file":"_id_.astro.mjs","sources":["../../../../../src/pages/api/bill-payments/[id].ts"],"sourcesContent":["import type { APIRoute } from \"astro\";\nimport { getSession } from \"../../../lib/get-session-astro\";\nimport { markPaymentPaid, markPaymentUnpaid, getPaymentStatus } from \"../../../lib/services/pay-periods\";\nimport { apiResponse, apiError } from \"../../../lib/api-utils\";\n\nexport const PATCH: APIRoute = async ({ request, params }) => {\n  const session = await getSession(request);\n  if (!session?.user?.id) {\n    return apiError(\"Unauthorized\", 401);\n  }\n\n  const { id } = params;\n  if (!id) {\n    return apiError(\"Payment ID required\", 400);\n  }\n\n  try {\n    const body = await request.json();\n    const { status, togglePaid } = body;\n\n    if (togglePaid) {\n      const currentStatus = await getPaymentStatus(session.user.id, id);\n      if (currentStatus === \"PAID\") {\n        const payment = await markPaymentUnpaid(session.user.id, id);\n        return apiResponse({ payment, debtUpdated: false });\n      } else {\n        const result = await markPaymentPaid(session.user.id, id);\n        return apiResponse(result);\n      }\n    } else if (status === \"PAID\") {\n      const result = await markPaymentPaid(session.user.id, id);\n      return apiResponse(result);\n    } else if (status === \"UNPAID\") {\n      const payment = await markPaymentUnpaid(session.user.id, id);\n      return apiResponse({ payment, debtUpdated: false });\n    } else {\n      return apiError(\"Invalid request. Provide 'status' (PAID/UNPAID) or 'togglePaid'\", 400);\n    }\n  } catch (error) {\n    return apiError(error instanceof Error ? error.message : \"Failed to update payment\", 400);\n  }\n};\n"],"names":[],"mappings":";;;;;AAKO,MAAM,KAAA,GAAkB,OAAO,EAAE,OAAA,EAAS,QAAO,KAAM;AAC5D,EAAA,MAAM,OAAA,GAAU,MAAM,UAAA,CAAW,OAAO,CAAA;AACxC,EAAA,IAAI,CAAC,OAAA,EAAS,IAAA,EAAM,EAAA,EAAI;AACtB,IAAA,OAAO,QAAA,CAAS,gBAAgB,GAAG,CAAA;AAAA,EACrC;AAEA,EAAA,MAAM,EAAE,IAAG,GAAI,MAAA;AACf,EAAA,IAAI,CAAC,EAAA,EAAI;AACP,IAAA,OAAO,QAAA,CAAS,uBAAuB,GAAG,CAAA;AAAA,EAC5C;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,IAAA,GAAO,MAAM,OAAA,CAAQ,IAAA,EAAK;AAChC,IAAA,MAAM,EAAE,MAAA,EAAQ,UAAA,EAAW,GAAI,IAAA;AAE/B,IAAA,IAAI,UAAA,EAAY;AACd,MAAA,MAAM,gBAAgB,MAAM,gBAAA,CAAiB,OAAA,CAAQ,IAAA,CAAK,IAAI,EAAE,CAAA;AAChE,MAAA,IAAI,kBAAkB,MAAA,EAAQ;AAC5B,QAAA,MAAM,UAAU,MAAM,iBAAA,CAAkB,OAAA,CAAQ,IAAA,CAAK,IAAI,EAAE,CAAA;AAC3D,QAAA,OAAO,WAAA,CAAY,EAAE,OAAA,EAAS,WAAA,EAAa,OAAO,CAAA;AAAA,MACpD,CAAA,MAAO;AACL,QAAA,MAAM,SAAS,MAAM,eAAA,CAAgB,OAAA,CAAQ,IAAA,CAAK,IAAI,EAAE,CAAA;AACxD,QAAA,OAAO,YAAY,MAAM,CAAA;AAAA,MAC3B;AAAA,IACF,CAAA,MAAA,IAAW,WAAW,MAAA,EAAQ;AAC5B,MAAA,MAAM,SAAS,MAAM,eAAA,CAAgB,OAAA,CAAQ,IAAA,CAAK,IAAI,EAAE,CAAA;AACxD,MAAA,OAAO,YAAY,MAAM,CAAA;AAAA,IAC3B,CAAA,MAAA,IAAW,WAAW,QAAA,EAAU;AAC9B,MAAA,MAAM,UAAU,MAAM,iBAAA,CAAkB,OAAA,CAAQ,IAAA,CAAK,IAAI,EAAE,CAAA;AAC3D,MAAA,OAAO,WAAA,CAAY,EAAE,OAAA,EAAS,WAAA,EAAa,OAAO,CAAA;AAAA,IACpD,CAAA,MAAO;AACL,MAAA,OAAO,QAAA,CAAS,mEAAmE,GAAG,CAAA;AAAA,IACxF;AAAA,EACF,SAAS,KAAA,EAAO;AACd,IAAA,OAAO,SAAS,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,4BAA4B,GAAG,CAAA;AAAA,EAC1F;AACF,CAAA;;;;;;;;;;;"}