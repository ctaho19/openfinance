{"version":3,"file":"bnpl-utils_Dcl5EXrQ.mjs","sources":["../../../src/lib/bnpl-utils.ts"],"sourcesContent":["export interface BNPLSchedule {\n  totalAmount: number;\n  numberOfPayments: number;\n  firstPaymentDate: Date;\n  frequency: 'weekly' | 'biweekly' | 'monthly';\n}\n\nexport interface PaymentScheduleResult {\n  paymentAmount: number;\n  paymentDates: Date[];\n}\n\nexport function generatePaymentSchedule(schedule: BNPLSchedule): PaymentScheduleResult {\n  const paymentAmount = Math.round((schedule.totalAmount / schedule.numberOfPayments) * 100) / 100;\n  const paymentDates: Date[] = [];\n\n  for (let i = 0; i < schedule.numberOfPayments; i++) {\n    const date = new Date(schedule.firstPaymentDate);\n    \n    switch (schedule.frequency) {\n      case 'weekly':\n        date.setDate(date.getDate() + (i * 7));\n        break;\n      case 'biweekly':\n        date.setDate(date.getDate() + (i * 14));\n        break;\n      case 'monthly':\n        date.setMonth(date.getMonth() + i);\n        break;\n    }\n    \n    paymentDates.push(date);\n  }\n\n  return { paymentAmount, paymentDates };\n}\n\nexport function formatPaymentPreview(\n  numberOfPayments: number,\n  paymentAmount: number,\n  firstPaymentDate: Date\n): string {\n  const formatter = new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric' });\n  return `${numberOfPayments} payments of $${paymentAmount.toFixed(2)} starting ${formatter.format(firstPaymentDate)}`;\n}\n\n/**\n * Calculate effective APR from a BNPL payment schedule.\n * This computes the implied interest rate when total repayable differs from principal.\n * \n * Uses a simple APR approximation: ((totalRepayable - principal) / principal) * (12 / months) * 100\n * For more accuracy, we could use Newton-Raphson to solve for IRR, but this is sufficient for display.\n */\nexport function calculateEffectiveAPR(params: {\n  principal: number;\n  totalRepayable: number;\n  numberOfPayments: number;\n  frequency: 'weekly' | 'biweekly' | 'monthly';\n}): number {\n  const { principal, totalRepayable, numberOfPayments, frequency } = params;\n  \n  if (principal <= 0 || totalRepayable <= 0 || numberOfPayments <= 0) {\n    return 0;\n  }\n  \n  // If no interest (total equals principal), return 0\n  if (Math.abs(totalRepayable - principal) < 0.01) {\n    return 0;\n  }\n  \n  // Calculate total finance charge\n  const financeCharge = totalRepayable - principal;\n  \n  // Determine loan term in months based on frequency\n  let termInMonths: number;\n  switch (frequency) {\n    case 'weekly':\n      termInMonths = (numberOfPayments * 7) / 30.44; // Average days per month\n      break;\n    case 'biweekly':\n      termInMonths = (numberOfPayments * 14) / 30.44;\n      break;\n    case 'monthly':\n      termInMonths = numberOfPayments;\n      break;\n  }\n  \n  // Simple APR approximation\n  // APR = (Finance Charge / Principal) / (Term in Years) * 100\n  const termInYears = termInMonths / 12;\n  const effectiveAPR = (financeCharge / principal) / termInYears * 100;\n  \n  // Round to 2 decimal places\n  return Math.round(effectiveAPR * 100) / 100;\n}\n\n/**\n * Calculate the \"effective rate\" to use for sorting/prioritization.\n * Returns the higher of stated APR or computed effective APR.\n */\nexport function getEffectiveRateForSorting(params: {\n  statedAPR: number;\n  principal: number;\n  totalRepayable: number;\n  numberOfPayments: number;\n  frequency: 'weekly' | 'biweekly' | 'monthly';\n}): number {\n  const computedAPR = calculateEffectiveAPR({\n    principal: params.principal,\n    totalRepayable: params.totalRepayable,\n    numberOfPayments: params.numberOfPayments,\n    frequency: params.frequency,\n  });\n  \n  // Use whichever is higher - stated or computed\n  return Math.max(params.statedAPR, computedAPR);\n}\n"],"names":[],"mappings":"AAYO,SAAS,wBAAwB,QAAA,EAA+C;AACrF,EAAA,MAAM,aAAA,GAAgB,KAAK,KAAA,CAAO,QAAA,CAAS,cAAc,QAAA,CAAS,gBAAA,GAAoB,GAAG,CAAA,GAAI,GAAA;AAC7F,EAAA,MAAM,eAAuB,EAAC;AAE9B,EAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,QAAA,CAAS,kBAAkB,CAAA,EAAA,EAAK;AAClD,IAAA,MAAM,IAAA,GAAO,IAAI,IAAA,CAAK,QAAA,CAAS,gBAAgB,CAAA;AAE/C,IAAA,QAAQ,SAAS,SAAA;AAAW,MAC1B,KAAK,QAAA;AACH,QAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,OAAA,EAAQ,GAAK,IAAI,CAAE,CAAA;AACrC,QAAA;AAAA,MACF,KAAK,UAAA;AACH,QAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,OAAA,EAAQ,GAAK,IAAI,EAAG,CAAA;AACtC,QAAA;AAAA,MACF,KAAK,SAAA;AACH,QAAA,IAAA,CAAK,QAAA,CAAS,IAAA,CAAK,QAAA,EAAS,GAAI,CAAC,CAAA;AACjC,QAAA;AAAA;AAGJ,IAAA,YAAA,CAAa,KAAK,IAAI,CAAA;AAAA,EACxB;AAEA,EAAA,OAAO,EAAE,eAAe,YAAA,EAAa;AACvC;AAEO,SAAS,oBAAA,CACd,gBAAA,EACA,aAAA,EACA,gBAAA,EACQ;AACR,EAAA,MAAM,SAAA,GAAY,IAAI,IAAA,CAAK,cAAA,CAAe,OAAA,EAAS,EAAE,KAAA,EAAO,OAAA,EAAS,GAAA,EAAK,SAAA,EAAW,CAAA;AACrF,EAAA,OAAO,CAAA,EAAG,gBAAgB,CAAA,cAAA,EAAiB,aAAA,CAAc,OAAA,CAAQ,CAAC,CAAC,CAAA,UAAA,EAAa,SAAA,CAAU,MAAA,CAAO,gBAAgB,CAAC,CAAA,CAAA;AACpH;AASO,SAAS,sBAAsB,MAAA,EAK3B;AACT,EAAA,MAAM,EAAE,SAAA,EAAW,cAAA,EAAgB,gBAAA,EAAkB,WAAU,GAAI,MAAA;AAEnE,EAAA,IAAI,SAAA,IAAa,CAAA,IAAK,cAAA,IAAkB,CAAA,IAAK,oBAAoB,CAAA,EAAG;AAClE,IAAA,OAAO,CAAA;AAAA,EACT;AAGA,EAAA,IAAI,IAAA,CAAK,GAAA,CAAI,cAAA,GAAiB,SAAS,IAAI,IAAA,EAAM;AAC/C,IAAA,OAAO,CAAA;AAAA,EACT;AAGA,EAAA,MAAM,gBAAgB,cAAA,GAAiB,SAAA;AAGvC,EAAA,IAAI,YAAA;AACJ,EAAA,QAAQ,SAAA;AAAW,IACjB,KAAK,QAAA;AACH,MAAA,YAAA,GAAgB,mBAAmB,CAAA,GAAK,KAAA;AACxC,MAAA;AAAA,IACF,KAAK,UAAA;AACH,MAAA,YAAA,GAAgB,mBAAmB,EAAA,GAAM,KAAA;AACzC,MAAA;AAAA,IACF,KAAK,SAAA;AACH,MAAA,YAAA,GAAe,gBAAA;AACf,MAAA;AAAA;AAKJ,EAAA,MAAM,cAAc,YAAA,GAAe,EAAA;AACnC,EAAA,MAAM,YAAA,GAAgB,aAAA,GAAgB,SAAA,GAAa,WAAA,GAAc,GAAA;AAGjE,EAAA,OAAO,IAAA,CAAK,KAAA,CAAM,YAAA,GAAe,GAAG,CAAA,GAAI,GAAA;AAC1C;;;;"}