{"version":3,"file":"bills_DrTPm3JP.mjs","sources":["../../../src/lib/services/bills.ts"],"sourcesContent":["import { prisma } from \"@/lib/db\";\nimport type { Bill, BillCategory, BillFrequency, Debt, BankAccount } from \"@prisma/client\";\n\nexport type BillWithRelations = Bill & {\n  debt: Debt | null;\n  bankAccount?: BankAccount | null;\n};\n\nexport interface CreateBillInput {\n  name: string;\n  amount: number;\n  dueDay: number;\n  category?: BillCategory;\n  isRecurring?: boolean;\n  frequency?: BillFrequency;\n  debtId?: string | null;\n  bankAccountId?: string | null;\n  notes?: string | null;\n}\n\nexport interface UpdateBillInput {\n  name?: string;\n  amount?: number;\n  dueDay?: number;\n  category?: BillCategory;\n  isRecurring?: boolean;\n  frequency?: BillFrequency;\n  debtId?: string | null;\n  bankAccountId?: string | null;\n  notes?: string | null;\n  isActive?: boolean;\n}\n\nexport async function listBills(userId: string): Promise<BillWithRelations[]> {\n  return prisma.bill.findMany({\n    where: { userId, isActive: true },\n    include: { debt: true, bankAccount: true },\n    orderBy: [{ category: \"asc\" }, { dueDay: \"asc\" }],\n  });\n}\n\nexport async function getBill(userId: string, billId: string): Promise<BillWithRelations | null> {\n  return prisma.bill.findFirst({\n    where: { id: billId, userId },\n    include: { debt: true, bankAccount: true },\n  });\n}\n\nexport async function createBill(userId: string, data: CreateBillInput): Promise<Bill> {\n  if (data.debtId) {\n    const debt = await prisma.debt.findFirst({\n      where: { id: data.debtId, userId },\n      select: { id: true },\n    });\n    if (!debt) {\n      throw new Error(\"Invalid debt reference\");\n    }\n  }\n\n  if (data.bankAccountId) {\n    const bankAccount = await prisma.bankAccount.findFirst({\n      where: { id: data.bankAccountId, userId },\n      select: { id: true },\n    });\n    if (!bankAccount) {\n      throw new Error(\"Invalid bank account reference\");\n    }\n  }\n\n  return prisma.bill.create({\n    data: {\n      userId,\n      name: data.name,\n      category: data.category || \"OTHER\",\n      amount: data.amount,\n      dueDay: data.dueDay,\n      isRecurring: data.isRecurring ?? true,\n      frequency: data.frequency || \"MONTHLY\",\n      debtId: data.debtId || null,\n      bankAccountId: data.bankAccountId || null,\n      notes: data.notes || null,\n    },\n  });\n}\n\nexport async function updateBill(\n  userId: string,\n  billId: string,\n  data: UpdateBillInput\n): Promise<Bill> {\n  const existing = await prisma.bill.findFirst({\n    where: { id: billId, userId },\n  });\n\n  if (!existing) {\n    throw new Error(\"Bill not found\");\n  }\n\n  return prisma.bill.update({\n    where: { id: billId },\n    data: {\n      ...(data.name !== undefined && { name: data.name }),\n      ...(data.category !== undefined && { category: data.category }),\n      ...(data.amount !== undefined && { amount: data.amount }),\n      ...(data.dueDay !== undefined && { dueDay: data.dueDay }),\n      ...(data.isRecurring !== undefined && { isRecurring: data.isRecurring }),\n      ...(data.frequency !== undefined && { frequency: data.frequency }),\n      ...(data.debtId !== undefined && { debtId: data.debtId || null }),\n      ...(data.bankAccountId !== undefined && { bankAccountId: data.bankAccountId || null }),\n      ...(data.notes !== undefined && { notes: data.notes || null }),\n      ...(data.isActive !== undefined && { isActive: data.isActive }),\n    },\n  });\n}\n\nexport async function deleteBill(userId: string, billId: string): Promise<Bill> {\n  const existing = await prisma.bill.findFirst({\n    where: { id: billId, userId },\n  });\n\n  if (!existing) {\n    throw new Error(\"Bill not found\");\n  }\n\n  return prisma.bill.update({\n    where: { id: billId },\n    data: { isActive: false },\n  });\n}\n"],"names":[],"mappings":"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"}