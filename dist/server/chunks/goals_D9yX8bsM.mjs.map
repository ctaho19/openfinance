{"version":3,"file":"goals_D9yX8bsM.mjs","sources":["../../../src/lib/services/goals.ts"],"sourcesContent":["import { prisma } from \"@/lib/db\";\nimport type { SavingsGoal, FOOStep } from \"@prisma/client\";\n\nexport interface CreateGoalInput {\n  name: string;\n  targetAmount: number;\n  currentAmount?: number;\n  deadline?: string | null;\n  fooStep?: FOOStep | null;\n  notes?: string | null;\n}\n\nexport interface UpdateGoalInput {\n  name?: string;\n  targetAmount?: number;\n  currentAmount?: number;\n  deadline?: string | null;\n  fooStep?: FOOStep | null;\n  notes?: string | null;\n}\n\nexport async function listGoals(userId: string): Promise<SavingsGoal[]> {\n  return prisma.savingsGoal.findMany({\n    where: { userId },\n    orderBy: { createdAt: \"desc\" },\n  });\n}\n\nexport async function getGoal(userId: string, goalId: string): Promise<SavingsGoal | null> {\n  return prisma.savingsGoal.findFirst({\n    where: { id: goalId, userId },\n  });\n}\n\nexport async function createGoal(userId: string, data: CreateGoalInput): Promise<SavingsGoal> {\n  if (!data.name || !data.targetAmount) {\n    throw new Error(\"Name and target amount are required\");\n  }\n\n  return prisma.savingsGoal.create({\n    data: {\n      userId,\n      name: data.name,\n      targetAmount: data.targetAmount,\n      currentAmount: data.currentAmount ?? 0,\n      deadline: data.deadline ? new Date(data.deadline) : null,\n      fooStep: data.fooStep || null,\n      notes: data.notes || null,\n    },\n  });\n}\n\nexport async function updateGoal(\n  userId: string,\n  goalId: string,\n  data: UpdateGoalInput\n): Promise<SavingsGoal> {\n  const existing = await prisma.savingsGoal.findFirst({\n    where: { id: goalId, userId },\n  });\n\n  if (!existing) {\n    throw new Error(\"Goal not found\");\n  }\n\n  return prisma.savingsGoal.update({\n    where: { id: goalId },\n    data: {\n      ...(data.name !== undefined && { name: data.name }),\n      ...(data.targetAmount !== undefined && { targetAmount: data.targetAmount }),\n      ...(data.currentAmount !== undefined && { currentAmount: data.currentAmount }),\n      ...(data.deadline !== undefined && { deadline: data.deadline ? new Date(data.deadline) : null }),\n      ...(data.fooStep !== undefined && { fooStep: data.fooStep || null }),\n      ...(data.notes !== undefined && { notes: data.notes || null }),\n    },\n  });\n}\n\nexport async function deleteGoal(userId: string, goalId: string): Promise<SavingsGoal> {\n  const existing = await prisma.savingsGoal.findFirst({\n    where: { id: goalId, userId },\n  });\n\n  if (!existing) {\n    throw new Error(\"Goal not found\");\n  }\n\n  return prisma.savingsGoal.delete({ where: { id: goalId } });\n}\n"],"names":[],"mappings":"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"}