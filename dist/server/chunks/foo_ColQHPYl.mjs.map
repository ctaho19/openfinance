{"version":3,"file":"foo_ColQHPYl.mjs","sources":["../../../src/lib/services/foo.ts"],"sourcesContent":["import { prisma } from \"@/lib/db\";\nimport type { FOOProgress, FOOStep, FOOStatus } from \"@prisma/client\";\n\nexport const FOO_STEPS: FOOStep[] = [\n  \"DEDUCTIBLES_COVERED\",\n  \"EMPLOYER_MATCH\",\n  \"HIGH_INTEREST_DEBT\",\n  \"EMERGENCY_FUND\",\n  \"ROTH_HSA\",\n  \"MAX_RETIREMENT\",\n  \"HYPERACCUMULATION\",\n  \"PREPAY_FUTURE\",\n  \"PREPAY_LOW_INTEREST\",\n];\n\nexport const FOO_STATUSES: FOOStatus[] = [\"NOT_STARTED\", \"IN_PROGRESS\", \"COMPLETED\"];\n\nexport const FOO_STEP_INFO: Record<FOOStep, { number: number; name: string; description: string }> = {\n  DEDUCTIBLES_COVERED: { number: 1, name: \"Cover Deductibles\", description: \"Save enough to cover insurance deductibles\" },\n  EMPLOYER_MATCH: { number: 2, name: \"Get Employer Match\", description: \"Contribute enough to get full employer 401k match\" },\n  HIGH_INTEREST_DEBT: { number: 3, name: \"Pay Off High-Interest Debt\", description: \"Pay off debts with interest rate > 6%\" },\n  EMERGENCY_FUND: { number: 4, name: \"Build Emergency Fund\", description: \"Save 3-6 months of expenses\" },\n  ROTH_HSA: { number: 5, name: \"Max Roth IRA & HSA\", description: \"Max out Roth IRA and HSA contributions\" },\n  MAX_RETIREMENT: { number: 6, name: \"Max Out Retirement\", description: \"Max out all retirement account contributions\" },\n  HYPERACCUMULATION: { number: 7, name: \"Hyperaccumulation\", description: \"Invest 25%+ of income in taxable accounts\" },\n  PREPAY_FUTURE: { number: 8, name: \"Prepay Future Expenses\", description: \"Prepay known future expenses\" },\n  PREPAY_LOW_INTEREST: { number: 9, name: \"Prepay Low-Interest Debt\", description: \"Prepay low-interest debts (< 6%)\" },\n};\n\nexport interface FOOProgressWithInfo extends FOOProgress {\n  stepInfo: { number: number; name: string; description: string };\n}\n\nexport interface UpdateFOOInput {\n  status?: FOOStatus;\n  targetAmount?: number | null;\n  currentAmount?: number | null;\n  notes?: string | null;\n}\n\nexport async function getFOOProgress(userId: string): Promise<FOOProgressWithInfo[]> {\n  const progress = await prisma.fOOProgress.findMany({\n    where: { userId },\n    orderBy: { step: \"asc\" },\n  });\n\n  const progressMap = new Map(progress.map((p) => [p.step, p]));\n\n  return FOO_STEPS.map((step) => {\n    const existing = progressMap.get(step);\n    const stepInfo = FOO_STEP_INFO[step];\n\n    if (existing) {\n      return { ...existing, stepInfo };\n    }\n\n    return {\n      id: \"\",\n      userId,\n      step,\n      status: \"NOT_STARTED\" as FOOStatus,\n      targetAmount: null,\n      currentAmount: null,\n      notes: null,\n      completedAt: null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      stepInfo,\n    };\n  });\n}\n\nexport async function updateFOOStep(\n  userId: string,\n  step: FOOStep,\n  data: UpdateFOOInput\n): Promise<FOOProgress> {\n  if (!FOO_STEPS.includes(step)) {\n    throw new Error(\"Invalid step\");\n  }\n\n  if (data.status && !FOO_STATUSES.includes(data.status)) {\n    throw new Error(\"Invalid status\");\n  }\n\n  const completedAt =\n    data.status === \"COMPLETED\" ? new Date() : data.status === \"NOT_STARTED\" ? null : undefined;\n\n  return prisma.fOOProgress.upsert({\n    where: {\n      userId_step: {\n        userId,\n        step,\n      },\n    },\n    update: {\n      ...(data.status && { status: data.status }),\n      ...(data.targetAmount !== undefined && { targetAmount: data.targetAmount }),\n      ...(data.currentAmount !== undefined && { currentAmount: data.currentAmount }),\n      ...(data.notes !== undefined && { notes: data.notes }),\n      ...(completedAt !== undefined && { completedAt }),\n    },\n    create: {\n      userId,\n      step,\n      status: data.status || \"NOT_STARTED\",\n      targetAmount: data.targetAmount ?? null,\n      currentAmount: data.currentAmount ?? null,\n      notes: data.notes ?? null,\n      completedAt: data.status === \"COMPLETED\" ? new Date() : null,\n    },\n  });\n}\n"],"names":[],"mappings":"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"}